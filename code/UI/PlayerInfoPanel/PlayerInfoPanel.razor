@using System.Linq;

@namespace Grubs

<root>
    <TextChat />
    @foreach (var player in GamemodeSystem.Instance.Players)
    {
        <PlayerInfo Player=@player />
    }
</root>

@code {
    public static PlayerInfoPanel Current;
    public PlayerInfoPanel() => Current = this;

    public void OnVoicePlayed(IClient client)
    {
        ChildrenOfType<PlayerInfo>().FirstOrDefault(e => e.Player.SteamId == client.SteamId)?.OnVoicePlayed();
    }

    public override void Tick()
    {
        // Show the voice indicator if the local client is talking
        if (Voice.IsRecording)
            OnVoicePlayed(Game.LocalClient);
    }

    protected override int BuildHash()
    {
        return HashCode.Combine(GamemodeSystem.Instance.Players.HashCombine(p => p.SteamId));
    }
}

<style>
    PlayerInfoPanel {
        position: absolute;
        bottom: 125px;
        left: 100px;
        flex-direction: column;
        justify-content: flex-end;
    }
</style>